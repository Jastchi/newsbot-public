<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0;
            padding: 0;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 0 4px 0;
            border-radius: 4px;
            text-align: center;
        }
        .global-summary {
            background: #f5f5f5;  
            border-radius: 0px; 
            line-height: 1.2; 
            text-align: center;
            border-bottom: 1px dashed #667eea;
        }
        h1 { 
            margin: 0; 
            font-size: 1.8em;
            word-wrap: break-word;
        }
        h2 { 
            color: #667eea; 
            border-bottom: 1px dashed #667eea; 
            padding: 0 0 4px 0; 
            margin: 8px 0 4px 0;
        }
        h3 { 
            color: #667eea; 
            margin: 15px 0 10px 0;
        }
        .story {
            background: white;
            padding: 15px 0;
            border-radius: 4px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .story-title {
            font-size: 1.4em;
            margin-bottom: 12px;
            font-weight: bold;
            word-wrap: break-word;
            color: #667eea;
            border-top: 2px solid #667eea;
            border-bottom: 2px solid #667eea;
        }
        .story-summary {
            line-height: 1.4;
            text-align: justify;
            margin-bottom: 12px;
            margin-left: 4px;
            margin-right: 4px;
            color: rgb(85,85,85);
        }
        .story-meta {
            color: #666;
            font-size: 0.85em;
            margin-bottom: 15px;
            padding: 10px 0;
            background: #f8f9fa;
            border-radius: 0;
        }
        .source-coverage {
            background: #f8f9fa;
            border-radius: 4px;
            padding-bottom: 6px;
            margin-bottom: 2px;
        }
        .source-header {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            margin-left: 8px;
            margin-bottom: 2px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }
        .article-item-border {
            border-left: 2px solid #667eea;
            background: white;
        }
        .article-item {
            padding: 4px 0 4px 8px;
            margin: 4px 0 4px 2px;
            border-radius: 0;
        }
        .article-title {
            font-weight: bold;
            color: #333;
            word-wrap: break-word;
        }
        .summary {
            color: #555;
            line-height: 1.5;
            word-wrap: break-word;
            padding: 10px;
            background: white;
            border-radius: 4px;
            margin-left: 4px;
            margin-right: 4px;
        }
        .sentiment {
            display: inline-block;
            padding: 4px 10px 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 0;
        }
        .sentiment.source-sentiment {
            padding: 4px 10px 4px 10px;
        }
        .sentiment-positive { background: #d4edda; color: #155724; }
        .sentiment-negative { background: #f8d7da; color: #721c24; }
        .sentiment-neutral { background: #e2e3e5; color: #383d41; }
        .sentiment-score {
            font-size: 0.9em;
            color: #666;
        }
        .footer {
            text-align: center;
            margin-top: 20px;
            padding: 20px 0;
            color: #666;
            font-size: 0.85em;
        }
        a { 
            color: #667eea; 
            text-decoration: none;
            word-wrap: break-word;
        }
        a:hover { text-decoration: underline; }
        .stories-list-header {
            text-align: left;
            margin-top: 15px;
            margin-bottom: 8px;
        }
        .stories-list {
            text-align: left;
            margin: 0;
            padding-left: 20px;
        }
        .stories-list-item {
            margin-bottom: 4px;
        }
        .additional-insights {
            margin-bottom: 10px;
        }
        .article-meta {
            color: #666;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ“° Top Stories in {{ topic }}</h1>
        <p>Cross-Source News Coverage & Sentiment Analysis</p>
        <p>{{ date_range }}</p>
    </div>
    
    <div class="global-summary">
        <h2>Summary</h2>
        <p><strong>Total Stories:</strong> {{ story_count }} |
        <strong>Total Articles:</strong> {{ total_articles }} |
        <strong>Sources Analyzed:</strong> {{ sources|length }}</p>
        <p><strong>Sources:</strong> {{ sources|join(', ') }}</p>
        
        <h3 class="stories-list-header">Stories in this report:</h3>
        <ol class="stories-list">
        {% for analysis in story_analyses %}
            <li class="stories-list-item"><a href="#story-{{ loop.index }}">{{ analysis.story.title }}</a></li>
        {% endfor %}
        </ol>
    </div>
    
    {% for analysis in story_analyses %}
    <div class="story" id="story-{{ loop.index }}">
        <div class="story-title">{{ loop.index }}. {{ analysis.story.title }}</div>

        {% if analysis.story.story_summary %}
        <div class="story-summary">{{ analysis.story.story_summary }}</div>
        {% endif %}
        
        <div class="story-meta">
            <strong>Coverage:</strong> {{ analysis.story.sources|length }} sources, {{ analysis.story.article_count }} articles<br>
            <strong>Sources:</strong> {{ analysis.story.sources|join(', ') }}<br>
            <strong>Time Range:</strong> {{ analysis.story.earliest_date.strftime('%Y-%m-%d %H:%M') }} to {{ analysis.story.latest_date.strftime('%Y-%m-%d %H:%M') }}
        </div>
        
        <h3>How Different Sources Cover This Story:</h3>
        
        {% for source in analysis.story.sources|sort %}
        <div class="source-coverage">
            <div class="source-header">
                <span>{{ source }}</span>
                {% if source in analysis.source_sentiments %}
                <span class="sentiment source-sentiment sentiment-{{ analysis.source_sentiments[source].label }}">
                    {{ analysis.source_sentiments[source].label|upper }}
                    <span class="sentiment-score">({{ "%.2f"|format(analysis.source_sentiments[source].avg_sentiment) }})</span>
                </span>
                {% endif %}
            </div>
            
            <div class="summary">
                {% if analysis.story.source_additional_points and source in analysis.story.source_additional_points and analysis.story.source_additional_points[source] %}
                <div class="additional-insights">
                    <strong>Additional insights</strong><br>
                    {{ analysis.story.source_additional_points[source] }}
                </div>
                {% endif %}
                {% for item in analysis.source_summaries.get(source, []) %}
                <div class="article-item-border">
                <div class="article-item">
                    <div class="article-title"><a href="{{ item.article.url }}" target="_blank">{{ item.article.title }}</a></div>
                    <div class="article-meta">
                        Published: {{ item.article.published_date.strftime('%Y-%m-%d %H:%M') }}
                        {% if item.article.sentiment %}
                        <span class="sentiment sentiment-{{ item.article.sentiment.label }}">
                            {{ item.article.sentiment.label }}
                        </span>
                        {% endif %}
                    </div>
                </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endfor %}
    
    <div class="footer">
        <p>Generated by NewsBot on {{ date }}</p>
        <p>This report analyzes how different news sources cover the same stories. If you have any questions or feedback, are interested in other topics or want to stop receiving these emails, please contact me at <a href="mailto:support@newsbot.com">PLACEHOLDER_EMAIL_ADDRESS</a>.</p>
        <p>Newsletters available: PLACEHOLDER_NEWSLETTERS</p>
    </div>
</body>
</html>
