<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0;
            padding: 0;
        }
        .header {
            background: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px 2px 16px 2px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 3px rgba(0,0,0,0.05);
            margin-bottom: 10px;
        }
        .global-summary {
            background: #f5f5f5;  
            border-radius: 8px; 
            line-height: 1.4; 
            text-align: center;
            border-bottom: 1.5px solid #667eea;
            padding: 10px 2px;
            margin-bottom: 10px;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        h1 { 
            margin: 0 0 4px 0; 
            font-size: 2.2em;
            word-wrap: break-word;
            font-weight: 700;
        }
        h2 { 
            color: #667eea; 
            border-bottom: 2px solid #667eea; 
            padding: 0 0 4px 0; 
            margin: 6px 0 6px 0;
            font-size: 1.5em;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        h3 { 
            color: #667eea; 
            margin: 10px 0 6px 0;
            font-size: 1.3em;
        }
        .story {
            background: white;
            padding: 10px 2px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .story-title {
            font-size: 1.6em;
            margin-bottom: 0;
            font-weight: 700;
            word-wrap: break-word;
            color: #667eea;
            border-top: 2.5px solid #667eea;
            padding-top: 6px;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }
        .story-summary {
            line-height: 1.6;
            text-align: justify;
            margin-bottom: 12px;
            margin-left: 0;
            margin-right: 0;
            padding: 0;
            color: rgb(85,85,85);
            border-bottom: 1.5px solid #667eea;
            background: transparent;
            border-radius: 4px;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        .story-summary-content {
            padding: 4px 4px;
            display: block;
        }
        .story-meta {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 8px;
            padding: 6px 2px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .source-coverage {
            background: #f5f5f5;
            border-radius: 6px;
            padding: 4px 2px;
            margin-bottom: 3px;
            border: 1px solid #e8e8e8;
        }
        .source-header {
            font-size: 1.2em;
            font-weight: 700;
            color: #667eea;
            margin-left: 0;
            margin-bottom: 2px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }
        .article-item-border {
            border-left: 1px solid #667eea;
            background: white;
            border-radius: 0 4px 4px 0;
        }
        .article-item {
            padding: 2px 2px;
            margin: 1px 0 0 1px;
            border-radius: 0;
        }
        .article-title {
            font-weight: 600;
            color: #333;
            word-wrap: break-word;
            font-size: 1.05em;
            margin-bottom: 0;
        }
        .summary {
            color: #555;
            line-height: 1.6;
            word-wrap: break-word;
            padding: 2px 2px;
            background: white;
            border-radius: 6px;
            margin-left: 0;
            margin-right: 0;
            margin-top: 2px;
        }
        .sentiment {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .article-meta .sentiment {
            margin-left: 0;
        }
        .sentiment.source-sentiment {
            padding: 6px 14px;
        }
        .sentiment-positive { background: #d4edda; color: #155724; }
        .sentiment-negative { background: #f8d7da; color: #721c24; }
        .sentiment-neutral { background: #e2e3e5; color: #383d41; }
        .sentiment-score {
            font-size: 0.9em;
            color: #666;
            margin-left: 4px;
        }
        .footer {
            text-align: center;
            margin-top: 10px;
            padding: 12px 2px;
            color: #666;
            font-size: 0.9em;
            background: #f8f9fa;
            border-radius: 8px;
        }
        a { 
            color: #667eea; 
            text-decoration: none;
            word-wrap: break-word;
            transition: color 0.2s ease;
        }
        a:hover { 
            text-decoration: underline; 
        }
        .stories-list-header {
            text-align: center;
            margin-top: 10px;
            margin-bottom: 8px;
            text-decoration: underline;
        }
        .stories-list {
            text-align: center;
            margin: 0;
            padding: 0;
            line-height: 1.8;
            list-style: none;
        }
        .stories-list-item {
            margin-bottom: 4px;
        }
        .stories-list-item a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }
        .stories-list-item a:hover {
            text-decoration: underline;
        }
        .additional-insights {
            margin-bottom: 2px;
            padding: 2px 2px;
        }
        .additional-insights strong {
            color: #667eea;
            font-size: 1.05em;
        }
        .article-meta {
            color: #666;
            font-size: 0.9em;
            margin-top: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="header" style="background: #667eea; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px 2px 16px 2px; border-radius: 8px; text-align: center; margin-bottom: 10px;">
        <h1>ðŸ“° Top Stories in {{ topic }}</h1>
        <p>Cross-Source News Coverage & Sentiment Analysis</p>
        <p>{{ date_range }}</p>
    </div>
    
    <div class="global-summary">
        <h2>Summary</h2>
        <p><strong>Total Stories:</strong> {{ story_count }} |
        <strong>Total Articles:</strong> {{ total_articles }} |
        <strong>Sources Analyzed:</strong> {{ sources|unique|list|length }}</p>
        <p><strong>Sources:</strong> {{ sources|unique|sort|join(', ') }}</p>
        
        <h3 class="stories-list-header">Stories</h3>
        <ol class="stories-list">
        {% for analysis in story_analyses %}
            <li class="stories-list-item"><a href="#story-{{ loop.index }}">{{ analysis.story.title }}</a></li>
        {% endfor %}
        </ol>
    </div>
    
    {% for analysis in story_analyses %}
    <div class="story" id="story-{{ loop.index }}">
        <div class="story-title">{{ loop.index }}. {{ analysis.story.title }}</div>

        {% if analysis.story.story_summary %}
        <div class="story-summary"><span class="story-summary-content">{{ analysis.story.story_summary }}</span></div>
        {% endif %}
        
        
        <h3>How Different Sources Cover This Story:</h3>
        
        {% for source in analysis.story.sources|unique|sort %}
        <div class="source-coverage">
            <div class="source-header">
                <span>{{ source }}</span>
                {% if source in analysis.source_sentiments %}
                <span class="sentiment source-sentiment sentiment-{{ analysis.source_sentiments[source].label }}">
                    {{ analysis.source_sentiments[source].label|upper }}
                    <span class="sentiment-score">({{ "%.2f"|format(analysis.source_sentiments[source].avg_sentiment) }})</span>
                </span>
                {% endif %}
            </div>
            
            {% if analysis.story.source_additional_points and source in analysis.story.source_additional_points and analysis.story.source_additional_points[source] %}
            <div class="additional-insights">
                {{ analysis.story.source_additional_points[source] }}
            </div>
            {% endif %}
            
            <div class="summary">
                {% for item in analysis.source_summaries.get(source, []) %}
                <div class="article-item-border">
                <div class="article-item">
                    <div class="article-title"><a href="{{ item.article.url }}" target="_blank">{{ item.article.title }}</a></div>
                    <div class="article-meta">
                        <span>Published: {{ item.article.published_date.strftime('%Y-%m-%d %H:%M') }}</span>
                        {% if item.article.sentiment %}
                        <span class="sentiment sentiment-{{ item.article.sentiment.label }}">
                            {{ item.article.sentiment.label }}
                        </span>
                        {% endif %}
                    </div>
                </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endfor %}
    
    <div class="footer">
        <p>Generated by NewsBot on {{ date }}</p>
        <p>This report analyzes how different news sources cover the same stories. If you have any questions or feedback, are interested in other topics or want to stop receiving these emails, please contact me at <a href="mailto:support@newsbot.com">PLACEHOLDER_EMAIL_ADDRESS</a>.</p>
        <p>Newsletters available: PLACEHOLDER_NEWSLETTERS</p>
    </div>
</body>
</html>
